<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>استمارة التطوير المهني للمعلمين</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js للرسوم البيانية -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f3f4f6;
        }

        /* تنسيقات خاصة بالطباعة A4 */
        @media print {
            @page {
                size: A4;
                margin: 0; /* تصفير هوامش الطابعة الافتراضية للتحكم بها عبر CSS */
            }
            body {
                background-color: white;
                -webkit-print-color-adjust: exact;
                margin: 0;
                padding: 0;
            }
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block !important;
            }
            .a4-page {
                width: 210mm;
                height: 296mm; /* تحديد ارتفاع A4 */
                padding: 15mm 20mm; /* هوامش داخلية موزونة: 15مم من الأعلى/الأسفل و 20مم من الجوانب */
                margin: 0 auto;
                background: white;
                position: relative;
                overflow: hidden; /* منع خروج أي عنصر خارج الصفحة */
            }
            /* إجبار الخلفيات والألوان على الظهور في الطباعة */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* تحسين ظهور الرسم البياني في الطباعة */
            #chartContainer {
                width: 100% !important;
                max-height: 200px !important;
                page-break-inside: avoid;
            }
        }

        .step-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .print-only {
            display: none;
        }
        
        /* تنسيق الصفحة للعرض العادي */
        .a4-page {
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- واجهة المستخدم (الاستمارة التفاعلية) -->
    <div class="min-h-screen flex flex-col items-center justify-center p-4 no-print" id="formContainer">
        
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl overflow-hidden">
            <!-- الهيدر -->
            <div class="bg-indigo-900 p-6 text-white text-center relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-indigo-800 rounded-full -mr-16 -mt-16 opacity-50"></div>
                <div class="absolute bottom-0 left-0 w-24 h-24 bg-indigo-700 rounded-full -ml-12 -mb-12 opacity-50"></div>
                <h1 class="text-3xl font-bold mb-2">استمارة التطوير المهني للمعلمين</h1>
                <p class="text-indigo-200">الرجاء تعبئة البيانات بدقة للانتقال للقسم التالي</p>
            </div>

            <!-- شريط التقدم -->
            <div class="flex justify-between items-center px-10 py-6 bg-gray-50 border-b">
                <div class="flex flex-col items-center step-indicator text-indigo-900 font-bold" id="ind-1">
                    <div class="w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center mb-1">1</div>
                    <span class="text-sm">بيانات أساسية</span>
                </div>
                <div class="flex-1 h-1 bg-gray-300 mx-4 rounded relative">
                    <div class="h-full bg-indigo-600 transition-all duration-300 w-0" id="progress-bar"></div>
                </div>
                <div class="flex flex-col items-center step-indicator text-gray-400" id="ind-2">
                    <div class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center mb-1">2</div>
                    <span class="text-sm">بيانات تطويرية</span>
                </div>
                <div class="flex-1 h-1 bg-gray-300 mx-4 rounded"></div>
                <div class="flex flex-col items-center step-indicator text-gray-400" id="ind-3">
                    <div class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center mb-1">3</div>
                    <span class="text-sm">خطة التطوير</span>
                </div>
            </div>

            <!-- نموذج البيانات -->
            <form id="teacherForm" class="p-8">
                
                <!-- القسم الأول: بيانات أساسية -->
                <div class="step-content active" id="step-1">
                    <h2 class="text-xl font-bold text-indigo-900 mb-6 border-b-2 border-indigo-100 pb-2">
                        <i class="fas fa-user-tie ml-2"></i>القسم الأول: بيانات أساسية
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">الاسم الرباعي <span class="text-red-500">*</span></label>
                            <input type="text" name="fullname" required class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition outline-none" placeholder="اكتب اسمك كاملاً">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">التخصص <span class="text-red-500">*</span></label>
                            <input type="text" name="specialization" required class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-indigo-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">المؤهل <span class="text-red-500">*</span></label>
                            <select name="qualification" required class="w-full border border-gray-300 rounded-lg p-2.5 bg-white outline-none">
                                <option value="">اختر المؤهل...</option>
                                <option value="بكالوريوس">بكالوريوس</option>
                                <option value="بكالوريوس + دبلوم عالي">بكالوريوس + دبلوم عالي</option>
                                <option value="ماجستير">ماجستير</option>
                                <option value="دكتوارة">دكتوارة</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">سنوات الخدمة <span class="text-red-500">*</span></label>
                            <select name="yearsOfService" required class="w-full border border-gray-300 rounded-lg p-2.5 bg-white outline-none">
                                <option value="">اختر المدة...</option>
                                <option value="أقل من 10 سنوات">أقل من 10 سنوات</option>
                                <option value="11 إلى 15 سنة">11 إلى 15 سنة</option>
                                <option value="16 إلى 20 سنة">16 إلى 20 سنة</option>
                                <option value="21 إلى 26 سنة">21 إلى 26 سنة</option>
                                <option value="أكثر من 26 سنة">أكثر من 26 سنة</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">المدرسة <span class="text-red-500">*</span></label>
                            <input type="text" name="school" required class="w-full border border-gray-300 rounded-lg p-2.5 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">المرحلة <span class="text-red-500">*</span></label>
                            <input type="text" name="level" required class="w-full border border-gray-300 rounded-lg p-2.5 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">النصاب التدريسي (عدد الحصص) <span class="text-red-500">*</span></label>
                            <input type="number" name="quota" required class="w-full border border-gray-300 rounded-lg p-2.5 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">رقم الجوال <span class="text-red-500">*</span></label>
                            <input type="tel" name="mobile" required class="w-full border border-gray-300 rounded-lg p-2.5 outline-none text-left" dir="ltr" placeholder="05xxxxxxxx">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">الإيميل الوزاري <span class="text-red-500">*</span></label>
                            <input type="email" name="email" required class="w-full border border-gray-300 rounded-lg p-2.5 outline-none text-left" dir="ltr">
                        </div>
                        
                        <div class="md:col-span-2 bg-indigo-50 p-4 rounded-lg">
                            <label class="block text-sm font-medium text-gray-700 mb-2">هل لديك مهام أخرى مكلف بها؟ <span class="text-red-500">*</span></label>
                            <div class="flex items-center gap-6">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="otherTasks" value="نعم" class="w-4 h-4 text-indigo-600" onchange="toggleTasksInput(true)">
                                    <span class="mr-2">نعم</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="otherTasks" value="لا" class="w-4 h-4 text-indigo-600" onchange="toggleTasksInput(false)" checked>
                                    <span class="mr-2">لا</span>
                                </label>
                            </div>
                            <input type="text" name="otherTasksDetails" id="otherTasksInput" class="w-full mt-3 border border-gray-300 rounded-lg p-2.5 hidden outline-none" placeholder="اذكر المهمة أو المهام...">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">اسم المدير المباشر <span class="text-red-500">*</span></label>
                            <input type="text" name="managerName" required class="w-full border border-gray-300 rounded-lg p-2.5 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">جوال المدير المباشر <span class="text-red-500">*</span></label>
                            <input type="tel" name="managerMobile" required class="w-full border border-gray-300 rounded-lg p-2.5 outline-none text-left" dir="ltr">
                        </div>
                    </div>
                    
                    <div class="mt-8 flex justify-end">
                        <button type="button" onclick="nextStep(1)" class="bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 transition flex items-center shadow-lg">
                            التالي <i class="fas fa-arrow-left mr-2"></i>
                        </button>
                    </div>
                </div>

                <!-- القسم الثاني: بيانات تطويرية -->
                <div class="step-content" id="step-2">
                    <h2 class="text-xl font-bold text-indigo-900 mb-6 border-b-2 border-indigo-100 pb-2">
                        <i class="fas fa-chart-line ml-2"></i>القسم الثاني: بيانات تطويرية
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block font-medium text-gray-800 mb-2">1. متى كانت آخر دورة تطويرية حصلت عليها؟ <span class="text-red-500">*</span></label>
                            <select name="dev_lastCourse" required class="w-full border border-gray-300 rounded-lg p-3 bg-white outline-none">
                                <option value="">اختر الإجابة...</option>
                                <option value="هذا العام">هذا العام</option>
                                <option value="العام الماضي">العام الماضي</option>
                                <option value="قبل عامين">قبل عامين</option>
                                <option value="قبل أكثر من 3 أعوام">قبل أكثر من 3 أعوام</option>
                                <option value="لا أتذكر">لا أتذكر</option>
                            </select>
                        </div>

                        <div>
                            <label class="block font-medium text-gray-800 mb-2">2. ما مدى استفادتك من البرامج التدريبية؟ <span class="text-red-500">*</span></label>
                            <select name="dev_benefit" required class="w-full border border-gray-300 rounded-lg p-3 bg-white outline-none">
                                <option value="">اختر الإجابة...</option>
                                <option value="لم أستفد منها">لم أستفد منها</option>
                                <option value="استفدت جزئيًا">استفدت جزئيًا</option>
                                <option value="استفدت فائدة متوسطة">استفدت فائدة متوسطة</option>
                                <option value="استفدت كثيرًا">استفدت كثيرًا</option>
                            </select>
                        </div>

                        <div>
                            <label class="block font-medium text-gray-800 mb-2">3. ما الذي تعتقد أنه أفضل بالنسبة لك؟ <span class="text-red-500">*</span></label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="border p-3 rounded-lg flex items-center cursor-pointer hover:bg-gray-50"><input type="radio" name="dev_preference" value="تدريب خارجي مع الإدارة" class="ml-2" required> تدريب خارجي مع الإدارة</label>
                                <label class="border p-3 rounded-lg flex items-center cursor-pointer hover:bg-gray-50"><input type="radio" name="dev_preference" value="تدريب داخل المدرسة" class="ml-2"> تدريب داخل المدرسة</label>
                                <label class="border p-3 rounded-lg flex items-center cursor-pointer hover:bg-gray-50"><input type="radio" name="dev_preference" value="تدريب مجاني" class="ml-2"> تدريب مجاني</label>
                                <label class="border p-3 rounded-lg flex items-center cursor-pointer hover:bg-gray-50"><input type="radio" name="dev_preference" value="تدريب مدفوع" class="ml-2"> تدريب مدفوع</label>
                            </div>
                        </div>

                        <div>
                            <label class="block font-medium text-gray-800 mb-2">4. ما الذي يعكس تطويرًا حقيقيًا لك كمعلم؟ <span class="text-red-500">*</span></label>
                            <select name="dev_reflection" required class="w-full border border-gray-300 rounded-lg p-3 bg-white outline-none">
                                <option value="">اختر الإجابة...</option>
                                <option value="تبادل الخبرات مع الزملاء">تبادل الخبرات مع الزملاء</option>
                                <option value="الاستفادة من معلم خبير">الاستفادة من معلم خبير</option>
                                <option value="حضور دورة متخصصة">حضور دورة متخصصة</option>
                                <option value="البحث عن الانترنت">البحث عن الانترنت</option>
                            </select>
                        </div>

                        <div>
                            <label class="block font-medium text-gray-800 mb-2">5. من خلال توطين التدريب بالمدارس، ما القيمة المضافة التي يمكنك تقديمها؟ <span class="text-red-500">*</span></label>
                            <textarea name="dev_addedValue" required rows="3" class="w-full border border-gray-300 rounded-lg p-3 outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                        </div>

                        <div>
                            <label class="block font-medium text-gray-800 mb-2">6. هل تعتقد أن التدريب احتياج فعلي أم تكليف مجهد لا معنى له؟ <span class="text-red-500">*</span></label>
                            <select name="dev_opinion" required class="w-full border border-gray-300 rounded-lg p-3 bg-white outline-none">
                                <option value="">اختر الإجابة...</option>
                                <option value="احتياج فعلي وضروري">احتياج فعلي وضروري</option>
                                <option value="جيد ولكن يحتاج تنظيم">جيد ولكن يحتاج تنظيم</option>
                                <option value="تكليف مجهد أحياناً">تكليف مجهد أحياناً</option>
                                <option value="لا معنى له">لا معنى له</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-8 flex justify-between">
                        <button type="button" onclick="prevStep(2)" class="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 transition">السابق</button>
                        <button type="button" onclick="nextStep(2)" class="bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 transition flex items-center shadow-lg">
                            التالي <i class="fas fa-arrow-left mr-2"></i>
                        </button>
                    </div>
                </div>

                <!-- القسم الثالث: خطة التطوير -->
                <div class="step-content" id="step-3">
                    <h2 class="text-xl font-bold text-indigo-900 mb-6 border-b-2 border-indigo-100 pb-2">
                        <i class="fas fa-bullseye ml-2"></i>القسم الثالث: خطة التطوير الفردية
                    </h2>

                    <div class="space-y-6">
                        <div>
                            <label class="block font-medium text-gray-800 mb-2">1. ما هي الممارسات المهنية التي يمكن أن تستفيد منها من خلال المدرسة؟ <span class="text-red-500">*</span></label>
                            <textarea name="plan_practices" required rows="4" class="w-full border border-gray-300 rounded-lg p-3 outline-none focus:ring-2 focus:ring-indigo-500" placeholder="اذكر الممارسات..."></textarea>
                        </div>

                        <div>
                            <label class="block font-medium text-gray-800 mb-2">2. ما هي المشاركات الاجتماعية داخل المدرسة التي تعتقد أنها ستحقق لك إضافة تطويرية؟ <span class="text-red-500">*</span></label>
                            <textarea name="plan_social" required rows="4" class="w-full border border-gray-300 rounded-lg p-3 outline-none focus:ring-2 focus:ring-indigo-500" placeholder="اذكر المشاركات..."></textarea>
                        </div>

                        <div>
                            <label class="block font-medium text-gray-800 mb-2">3. ما الدورات أو الكتب أو المصادر التي تعتقد أنها تشكل أهمية بالنسبة لك؟ <span class="text-red-500">*</span></label>
                            <textarea name="plan_resources" required rows="4" class="w-full border border-gray-300 rounded-lg p-3 outline-none focus:ring-2 focus:ring-indigo-500" placeholder="اذكر المصادر..."></textarea>
                        </div>
                    </div>

                    <div class="mt-10 bg-green-50 border border-green-200 rounded-xl p-6 text-center">
                        <i class="fas fa-quote-right text-green-300 text-2xl mb-2 block"></i>
                        <p class="text-green-800 font-bold text-lg mb-2">أشكرك على مشاركتك التي تدل على حرصك ودعمك لعملية التطوير المستمرة</p>
                        <p class="text-green-700">أنت معلم قادر على صناعة الفرق <i class="fas fa-star text-yellow-500"></i></p>
                    </div>

                    <div class="mt-8 flex justify-between">
                        <button type="button" onclick="prevStep(3)" class="bg-gray-500 text-white px-8 py-3 rounded-lg hover:bg-gray-600 transition">السابق</button>
                        <button type="button" onclick="generateReport()" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition flex items-center shadow-lg transform hover:scale-105">
                            <i class="fas fa-check-circle ml-2"></i> اعتماد وعرض التقرير
                        </button>
                    </div>
                </div>

            </form>
        </div>
    </div>

    <!-- قالب التقرير للطباعة (مخفي افتراضياً ويظهر عند الطباعة أو الانتهاء) -->
    <div id="reportView" class="hidden print-only bg-white">
        <div class="a4-page mx-auto relative text-black">
            
            <!-- ترويسة التقرير -->
            <header class="flex justify-between items-center border-b-4 border-black pb-4 mb-6">
                <div class="text-right">
                    <h2 class="font-bold text-lg">وزارة التعليم</h2>
                    <h3 class="text-md">استمارة التطوير المهني للمعلم</h3>
                </div>
                <div class="text-center">
                    <div class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center border-2 border-black">
                        <i class="fas fa-university text-3xl"></i>
                    </div>
                </div>
                <div class="text-left">
                    <p class="text-sm">التاريخ: <span id="printDate"></span></p>
                    <p class="text-sm">حالة الملف: <span class="font-bold">مكتمل</span></p>
                </div>
            </header>

            <!-- محتوى التقرير -->
            <div class="grid grid-cols-2 gap-4 mb-6 text-sm border border-black p-4 rounded bg-gray-50">
                <div class="col-span-2 font-bold text-center bg-gray-200 py-1 mb-2 border border-gray-400">البيانات الأساسية</div>
                <p><strong>الاسم:</strong> <span id="r_name"></span></p>
                <p><strong>التخصص:</strong> <span id="r_spec"></span></p>
                <p><strong>المدرسة:</strong> <span id="r_school"></span></p>
                <p><strong>المؤهل:</strong> <span id="r_qual"></span></p>
                <p><strong>الجوال:</strong> <span id="r_mobile"></span></p>
                <p><strong>سنوات الخدمة:</strong> <span id="r_service"></span></p>
                <p><strong>المدير المباشر:</strong> <span id="r_manager"></span></p>
                <p><strong>النصاب:</strong> <span id="r_quota"></span></p>
            </div>

            <div class="mb-6 w-full">
                <div class="font-bold text-center bg-gray-200 py-1 mb-2 border border-gray-400">التحليل البياني للمسار التطويري</div>
                <div class="flex items-center justify-center border border-gray-300 p-2 w-full" style="height: 220px;">
                    <!-- حاوية الرسم البياني لضمان الاحتواء -->
                    <div id="chartContainer" class="w-full h-full relative flex justify-center">
                        <canvas id="analysisChart"></canvas>
                    </div>
                </div>
                <div class="mt-2 text-xs text-gray-600 text-center">
                    * يوضح الرسم البياني أعلاه تحليل توجهاتك التدريبية بناءً على المدخلات في القسم الثاني.
                </div>
            </div>

            <div class="space-y-4 text-sm">
                <div class="font-bold text-center bg-gray-200 py-1 border border-gray-400">خطة التطوير الفردية</div>
                
                <div class="border-r-4 border-gray-800 pr-3">
                    <h4 class="font-bold underline">الممارسات المهنية المستهدفة:</h4>
                    <p id="r_practices" class="mt-1 text-gray-800 whitespace-pre-line"></p>
                </div>
                
                <div class="border-r-4 border-gray-800 pr-3">
                    <h4 class="font-bold underline">المشاركات الاجتماعية:</h4>
                    <p id="r_social" class="mt-1 text-gray-800 whitespace-pre-line"></p>
                </div>

                <div class="border-r-4 border-gray-800 pr-3">
                    <h4 class="font-bold underline">مصادر التعلم والدورات المقترحة:</h4>
                    <p id="r_resources" class="mt-1 text-gray-800 whitespace-pre-line"></p>
                </div>
            </div>

            <!-- تذييل -->
            <div class="mt-8 border-t-2 border-black pt-4 flex justify-between text-sm">
                <div>
                    <p class="font-bold">توقيع المعلم:</p>
                    <p class="mt-8 text-gray-400">.............................</p>
                </div>
                <div>
                    <p class="font-bold">اعتماد المدير:</p>
                    <p class="mt-8 text-gray-400">.............................</p>
                </div>
                <div class="text-left w-1/3">
                    <p class="italic text-xs">"أنت معلم قادر على صناعة الفرق"</p>
                </div>
            </div>
        </div>

        <!-- أزرار التحكم في الطباعة والإرسال (لا تظهر عند الطباعة الفعلية) -->
        <div class="fixed bottom-0 left-0 w-full bg-gray-900 text-white p-4 text-center no-print shadow-lg z-50 flex justify-center gap-4">
            <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full flex items-center">
                <i class="fas fa-print ml-2"></i> طباعة / حفظ PDF
            </button>
            <button onclick="sendEmail()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full flex items-center">
                <i class="fas fa-envelope ml-2"></i> إرسال للإيميل
            </button>
            <button onclick="location.reload()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full flex items-center">
                <i class="fas fa-redo ml-2"></i> استمارة جديدة
            </button>
        </div>
    </div>

    <script>
        // التعامل مع الانتقال بين الخطوات
        let currentStep = 1;

        function toggleTasksInput(show) {
            const input = document.getElementById('otherTasksInput');
            if (show) {
                input.classList.remove('hidden');
                input.required = true;
            } else {
                input.classList.add('hidden');
                input.required = false;
                input.value = '';
            }
        }

        function validateStep(step) {
            const stepDiv = document.getElementById(`step-${step}`);
            const inputs = stepDiv.querySelectorAll('input, select, textarea');
            let isValid = true;

            inputs.forEach(input => {
                if (input.hasAttribute('required') && !input.value.trim()) {
                    isValid = false;
                    input.classList.add('border-red-500');
                    // إزالة الاحمرار عند الكتابة
                    input.addEventListener('input', function() {
                        this.classList.remove('border-red-500');
                    }, {once: true});
                }
            });

            if (!isValid) {
                alert('يرجى تعبئة جميع الحقول المطلوبة قبل الانتقال.');
            }
            return isValid;
        }

        function nextStep(step) {
            if (validateStep(step)) {
                document.getElementById(`step-${step}`).classList.remove('active');
                document.getElementById(`step-${step + 1}`).classList.add('active');
                
                // تحديث شريط التقدم
                const progress = (step / 2) * 100;
                document.getElementById('progress-bar').style.width = `${progress}%`;
                
                // تلوين المؤشر
                document.getElementById(`ind-${step + 1}`).classList.remove('text-gray-400');
                document.getElementById(`ind-${step + 1}`).classList.add('text-indigo-900', 'font-bold');
                document.getElementById(`ind-${step + 1}`).querySelector('div').classList.remove('bg-gray-300', 'text-gray-600');
                document.getElementById(`ind-${step + 1}`).querySelector('div').classList.add('bg-indigo-600', 'text-white');
                
                currentStep++;
            }
        }

        function prevStep(step) {
            document.getElementById(`step-${step}`).classList.remove('active');
            document.getElementById(`step-${step - 1}`).classList.add('active');
            
            const progress = ((step - 2) / 2) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            
            // إعادة لون المؤشر
            document.getElementById(`ind-${step}`).classList.add('text-gray-400');
            document.getElementById(`ind-${step}`).classList.remove('text-indigo-900', 'font-bold');
            document.getElementById(`ind-${step}`).querySelector('div').classList.add('bg-gray-300', 'text-gray-600');
            document.getElementById(`ind-${step}`).querySelector('div').classList.remove('bg-indigo-600', 'text-white');
            
            currentStep--;
        }

        function generateReport() {
            if (!validateStep(3)) return;

            // إخفاء النموذج وإظهار التقرير
            document.getElementById('formContainer').style.display = 'none';
            document.getElementById('reportView').classList.remove('hidden');
            document.getElementById('reportView').classList.add('block'); // For screen viewing
            
            // تعبئة البيانات في التقرير
            const form = document.getElementById('teacherForm');
            const formData = new FormData(form);
            
            document.getElementById('printDate').innerText = new Date().toLocaleDateString('ar-SA');
            document.getElementById('r_name').innerText = formData.get('fullname');
            document.getElementById('r_spec').innerText = formData.get('specialization');
            document.getElementById('r_qual').innerText = formData.get('qualification');
            document.getElementById('r_service').innerText = formData.get('yearsOfService');
            document.getElementById('r_school').innerText = formData.get('school');
            document.getElementById('r_mobile').innerText = formData.get('mobile');
            document.getElementById('r_quota').innerText = formData.get('quota');
            document.getElementById('r_manager').innerText = formData.get('managerName');
            
            document.getElementById('r_practices').innerText = formData.get('plan_practices');
            document.getElementById('r_social').innerText = formData.get('plan_social');
            document.getElementById('r_resources').innerText = formData.get('plan_resources');

            // إنشاء الرسم البياني
            createChart(formData);
        }

        function createChart(formData) {
            const ctx = document.getElementById('analysisChart').getContext('2d');
            
            // تحويل البيانات النصية إلى قيم رقمية تقديرية للرسم
            const benefit = formData.get('dev_benefit');
            let benefitScore = 2; // Default
            if (benefit.includes('كثير')) benefitScore = 10;
            else if (benefit.includes('متوسط')) benefitScore = 7;
            else if (benefit.includes('جزئي')) benefitScore = 4;
            else benefitScore = 2;

            const courseTime = formData.get('dev_lastCourse');
            let recencyScore = 2;
            if (courseTime.includes('هذا العام')) recencyScore = 10;
            else if (courseTime.includes('العام الماضي')) recencyScore = 8;
            else if (courseTime.includes('قبل عامين')) recencyScore = 5;
            else recencyScore = 2;

            const trainingOpinion = formData.get('dev_opinion');
            let attitudeScore = 5;
            if (trainingOpinion.includes('ضروري')) attitudeScore = 10;
            else if (trainingOpinion.includes('تنظيم')) attitudeScore = 7;
            else if (trainingOpinion.includes('مجهد')) attitudeScore = 4;
            else attitudeScore = 2;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['حداثة التدريب', 'مدى الاستفادة', 'القناعة بالتدريب'],
                    datasets: [{
                        label: 'مؤشر الأداء التطويري',
                        data: [recencyScore, benefitScore, attitudeScore],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(153, 102, 255, 0.6)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // مهم جداً: لملء الحاوية بشكل صحيح
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function sendEmail() {
            // ملاحظة: هذا الحل باستخدام mailto هو الأكثر أماناً لكود يعمل على المتصفح فقط بدون سيرفر
            // سيقوم بفتح تطبيق الإيميل وتعبئة البيانات تلقائياً
            
            const form = document.getElementById('teacherForm');
            const formData = new FormData(form);
            
            const subject = encodeURIComponent("استمارة تطوير مهني - " + formData.get('fullname'));
            
            let body = `الاسم: ${formData.get('fullname')}
التخصص: ${formData.get('specialization')}
المدرسة: ${formData.get('school')}
المؤهل: ${formData.get('qualification')}

--- بيانات تطويرية ---
آخر دورة: ${formData.get('dev_lastCourse')}
مدى الاستفادة: ${formData.get('dev_benefit')}
القيمة المضافة: ${formData.get('dev_addedValue')}

--- الخطة ---
الممارسات: ${formData.get('plan_practices')}
المشاركات: ${formData.get('plan_social')}
المصادر: ${formData.get('plan_resources')}
`;
            
            const bodyEncoded = encodeURIComponent(body);
            window.location.href = `mailto:asirimay2@gmail.com?subject=${subject}&body=${bodyEncoded}`;
        }
    </script>
</body>
</html>
